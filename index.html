<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCM Input Form</title>
    <!-- PERUBAHAN: Menambahkan Google Font "Inter" -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* --- General Styling & Background --- */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            /* PERUBAHAN: Mengganti font utama menjadi "Inter" */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        body {
            background-image: url('background.jpg'); /* <-- Ganti dengan nama file background Anda */
            background-color: #000000;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        /* --- Content Card (Black & Gold Theme) --- */
        .container {
            position: relative;
            z-index: 1;
            width: 100%;
            max-width: 650px;
            background: rgba(10, 10, 10, 0.75);
            padding: 30px 40px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            text-align: left;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            max-height: 85vh;
            overflow-y: auto;
            color: #e0e0e0;
        }

        /* --- Custom Scrollbar Styling --- */
        .container::-webkit-scrollbar { width: 8px; }
        .container::-webkit-scrollbar-track { background: rgba(212, 175, 55, 0.1); border-radius: 10px; }
        .container::-webkit-scrollbar-thumb { background: rgba(212, 175, 55, 0.4); border-radius: 10px; }
        .container::-webkit-scrollbar-thumb:hover { background: rgba(212, 175, 55, 0.6); }

        /* --- Header: Logo, Title, Status --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        .logo {
            max-height: 50px;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
        }
        h2 {
            margin: 0;
            color: #D4AF37; /* Gold Color */
            font-size: 24px;
            font-weight: 600;
        }
        .status {
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 20px;
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* --- Form Styling --- */
        label, legend {
            font-weight: 500;
            font-size: 16px;
            margin-bottom: 8px;
            display: block;
            color: #cccccc;
        }
        legend {
            color: #D4AF37;
            padding: 0 10px;
            font-weight: 600;
        }
        fieldset {
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            background-color: rgba(0, 0, 0, 0.2);
        }
        input[type="text"], input[type="number"], input[type="date"], select {
            width: 100%;
            margin-top: 5px;
            padding: 12px;
            border-radius: 6px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            background-color: rgba(0, 0, 0, 0.3);
            color: #e0e0e0;
            font-size: 16px;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif; /* Pastikan elemen form juga menggunakan font Inter */
        }
        input:focus, select:focus {
            outline: none;
            border-color: #D4AF37;
            box-shadow: 0 0 8px rgba(212, 175, 55, 0.5);
        }
        select {
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="gold" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
        }

        /* --- Buttons --- */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            flex-grow: 1;
            font-family: 'Inter', sans-serif; /* Pastikan tombol juga menggunakan font Inter */
        }
        .submit-btn {
            background-color: #D4AF37;
            color: #121212;
        }
        .submit-btn:hover {
            background-color: #f0c44c;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.6);
        }
        .reset-btn {
            background-color: rgba(255, 255, 255, 0.15);
            color: #e0e0e0;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }
        .reset-btn:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }

        /* --- Notifications --- */
        #notif, #ncm-result {
            margin-top: 20px;
            font-weight: 500;
            padding: 12px;
            border-radius: 6px;
            text-align: center;
            display: none; /* Sembunyikan secara default */
        }
        #ncm-result {
            color: #D4AF37;
            background-color: rgba(212, 175, 55, 0.1);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* PERUBAHAN: Penyesuaian khusus untuk layar kecil (Android & iPhone) */
        @media (max-width: 768px) {
            body {
                padding: 20px 10px; /* Kurangi padding di sisi kiri dan kanan */
                align-items: center; /* Pusatkan container di tengah untuk layar kecil */
            }
            .container {
                padding: 20px; /* Kurangi padding di dalam container */
                max-height: 90vh; /* Izinkan container sedikit lebih tinggi di HP */
            }
            h2 {
                font-size: 20px; /* Kecilkan sedikit ukuran judul */
            }
            .header {
                flex-direction: column; /* Susun logo dan judul ke bawah */
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="logo.png" alt="Logo" class="logo"> <!-- <-- Ganti dengan nama file logo Anda -->
            <h2>NCM INPUT FORM</h2>
            <span class="status" id="status-indicator">🟢 Online</span>
        </div>

        <form id="barcode-form">
            <fieldset>
                <legend>Header Info</legend>
                <label>Nama: <input type="text" name="nama" required></label>
                <label>Tanggal: <input type="date" name="tanggal" required></label>
                <label>Issue: <input type="text" name="issue" required></label>
            </fieldset>

            <fieldset>
                <legend>Material Details</legend>
                <label>Jumlah Material:
                    <select id="jumlah" name="jumlah">
                        <option value="1">1</option> <option value="2">2</option> <option value="3">3</option>
                        <option value="4">4</option> <option value="5">5</option> <option value="6">6</option>
                        <option value="7">7</option> <option value="8">8</option> <option value="9">9</option>
                        <option value="10">10</option>
                    </select>
                </label>
            </fieldset>

            <div id="bobbin-fields"></div>

            <div class="button-group">
                <button type="submit" class="submit-btn">Submit</button>
                <button type="button" class="reset-btn" onclick="handleReset()">Reset</button>
            </div>
            
            <div id="notif"></div>
            <div id="ncm-result"></div>
        </form>
    </div>

    <script>
        const form = document.getElementById('barcode-form');
        const bobbinFields = document.getElementById('bobbin-fields');
        const jumlahSelect = document.getElementById('jumlah');
        const statusEl = document.getElementById('status-indicator');
        const notifEl = document.getElementById('notif');
        const ncmResultEl = document.getElementById('ncm-result');

        function generateBobbinFields(count) {
            bobbinFields.innerHTML = '';
            for (let i = 1; i <= count; i++) {
                const fieldset = document.createElement('fieldset');
                fieldset.innerHTML = `
                    <legend>Material ${i}</legend>
                    <label>Barcode: <input type="text" name="barcode${i}" required></label>
                    <label>QTY (Kg / Pcs / Stick / Bobbin): <input type="number" name="berat${i}" step="any" required></label>
                `;
                bobbinFields.appendChild(fieldset);
            }
        }

        function handleReset() {
            form.reset();
            generateBobbinFields(1);
            notifEl.textContent = '';
            notifEl.style.display = 'none';
            ncmResultEl.textContent = '';
            ncmResultEl.style.display = 'none';
        }

        function showNotification(message, type) {
            notifEl.textContent = message;
            notifEl.style.display = 'block';
            switch(type) {
                case 'success':
                    notifEl.style.color = '#4CAF50'; // Green
                    notifEl.style.backgroundColor = 'rgba(76, 175, 80, 0.1)';
                    break;
                case 'error':
                    notifEl.style.color = '#F44336'; // Red
                    notifEl.style.backgroundColor = 'rgba(244, 67, 54, 0.1)';
                    break;
                case 'loading':
                    notifEl.style.color = '#FFC107'; // Amber
                    notifEl.style.backgroundColor = 'rgba(255, 193, 7, 0.1)';
                    break;
                default:
                    notifEl.style.color = '#e0e0e0';
                    notifEl.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
            }
        }

        jumlahSelect.addEventListener('change', (e) => {
            generateBobbinFields(Number(e.target.value));
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            showNotification('⏳ Sending data...', 'loading');
            ncmResultEl.style.display = 'none';

            const data = new FormData(form);
            const payload = {
                nama: data.get('nama'),
                tanggal: data.get('tanggal'),
                issue: data.get('issue'),
                jumlah: Number(data.get('jumlah')),
                bobbin: []
            };

            for (let i = 1; i <= payload.jumlah; i++) {
                payload.bobbin.push({
                    barcode: data.get(`barcode${i}`),
                    berat: data.get(`berat${i}`)
                });
            }

            try {
                const response = await fetch("https://script.google.com/macros/s/AKfycbyyOj9kIf1mihKdNKzQC-9O6iYM0cefAKq_8NWskwqQv1bm5wSCp_mlV-mQrKgVGNkg/exec", {
                    method: "POST",
                    body: JSON.stringify(payload),
                    mode: 'no-cors' // Use no-cors if the script doesn't return CORS headers
                });
                
                // Since the original script might not return a proper JSON response with CORS,
                // we assume success and let the user check the result separately.
                // A better approach is to modify the Google Apps Script to return a proper JSON response.
                showNotification('✅ Data sent successfully! Please verify the result.', 'success');
                // The following lines might not work as expected with no-cors
                // const result = await response.json();
                // if (result.success) {
                //     showNotification('✅ Data sent successfully!', 'success');
                //     ncmResultEl.textContent = '🆔 Your NCM ID: ' + result.ncm;
                //     ncmResultEl.style.display = 'block';
                // } else {
                //     showNotification('❌ Failed to save data. ' + (result.error || ''), 'error');
                // }

                setTimeout(() => {
                    handleReset();
                }, 4000);

            } catch (error) {
                showNotification('❌ Network error. Failed to send data.', 'error');
                console.error('Error:', error);
            }
        });

        function updateStatus() {
            statusEl.textContent = navigator.onLine ? "🟢 Online" : "🔴 Offline";
        }
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);
        
        // Initial setup
        updateStatus();
        generateBobbinFields(1);
    </script>
</body>
</html>
