<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scan Barcode GS1-128</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 10px;
        max-width: 500px;
        margin: auto;
      }
      video {
        border: 1px solid black;
        width: 100%;
        max-width: 400px;
      }
      input, button, select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        margin-bottom: 10px;
      }
      label {
        font-weight: bold;
      }
      #scanner-frame {
        position: absolute;
        border: 2px dashed red;
        width: 80%;
        height: 40%;
        top: 25%;
        left: 10%;
        pointer-events: none;
        box-sizing: border-box;
      }
    </style>
    <script src="https://unpkg.com/@zxing/library@latest"></script>
  </head>
  <body>
    <h2>Scan Barcode GS1-128</h2>
    <div style="position: relative;">
      <video id="video" autoplay></video>
      <div id="scanner-frame"></div>
    </div>

    <form action="https://script.google.com/macros/s/AKfycbyuRpLVKpKB-kprbmNiZdJFujo4kxzXJbrR2sfL90y85zff01EcVhJ6Wol_Yj-6LXQU/exec" method="POST">
      <label>Barcode:</label>
      <input type="text" id="barcode" name="barcode" required />

      <label>SKU (isi jika manual):</label>
      <input type="text" id="sku" name="sku" disabled />

      <label>Nama:</label>
      <input type="text" name="nama" required />

      <label>Berat:</label>
      <input type="number" name="berat" required />

      <label>Issue:</label>
      <input type="text" name="issue" required />

      <label>NCM:</label>
      <input type="text" name="ncm" required />

      <button type="submit">Kirim</button>
    </form>

    <script>
      const codeReader = new ZXing.BrowserMultiFormatReader();
      const videoElement = document.getElementById("video");
      const barcodeInput = document.getElementById("barcode");
      const skuInput = document.getElementById("sku");

      // Kamera dengan auto focus & zoom
      codeReader.listVideoInputDevices().then((devices) => {
        if (devices.length > 0) {
          const deviceId = devices[0].deviceId;
          navigator.mediaDevices.getUserMedia({
            video: {
              deviceId: { exact: deviceId },
              facingMode: "environment",
              advanced: [{ zoom: 2 }]
            }
          })
          .then((stream) => {
            videoElement.srcObject = stream;
            codeReader.decodeFromVideoDevice(deviceId, videoElement, (result, err) => {
              if (result) {
                barcodeInput.value = result.text;
                skuInput.disabled = true; // disable kolom SKU jika hasil dari scan
                const beep = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");
                beep.play();
              }
            });
          })
          .catch((err) => {
            alert("❌ Gagal akses kamera: " + err.message);
          });
        } else {
          alert("❌ Kamera tidak ditemukan.");
        }
      });

      // Enable kolom SKU jika barcode ditulis manual
      barcodeInput.addEventListener("input", () => {
        if (barcodeInput.value.length === 0) {
          skuInput.disabled = true;
        } else {
          skuInput.disabled = !barcodeInput.readOnly;
        }
      });
    </script>
  </body>
</html>
