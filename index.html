<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Input Barcode - Mode Zebra Scanner</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, select, button { width: 100%; padding: 8px; margin-top: 5px; margin-bottom: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h2>Input Barcode - Mode Zebra Scanner</h2>

  <label for="mode">Mode Input:</label>
  <select id="mode">
    <option value="single">Single</option>
    <option value="massal">Massal</option>
  </select>

  <div id="jumlah-bobbin-section" class="hidden">
    <label for="jumlahBobbin">Jumlah Bobbin:</label>
    <select id="jumlahBobbin">
      <option value="">Pilih...</option>
      <script>
        document.write([...Array(10).keys()].map(i => `<option value="${i+1}">${i+1}</option>`).join(''));
      </script>
    </select>
  </div>

  <div id="form-container"></div>

  <label for="tanggal">Tanggal:</label>
  <input type="date" id="tanggal">

  <label for="nama">Nama:</label>
  <input type="text" id="nama">

  <label for="issue">Issue:</label>
  <input type="text" id="issue">

  <label for="ncm">NCM:</label>
  <input type="text" id="ncm">

  <button onclick="kirimData()">Kirim</button>

  <script>
    const modeSelect = document.getElementById('mode');
    const jumlahBobbinSection = document.getElementById('jumlah-bobbin-section');
    const jumlahBobbinSelect = document.getElementById('jumlahBobbin');
    const formContainer = document.getElementById('form-container');

    modeSelect.addEventListener('change', () => {
      if (modeSelect.value === 'massal') {
        jumlahBobbinSection.classList.remove('hidden');
        renderMassalForm(jumlahBobbinSelect.value);
      } else {
        jumlahBobbinSection.classList.add('hidden');
        renderSingleForm();
      }
    });

    jumlahBobbinSelect.addEventListener('change', () => {
      if (modeSelect.value === 'massal') {
        renderMassalForm(jumlahBobbinSelect.value);
      }
    });

    function renderSingleForm() {
      formContainer.innerHTML = `
        <label for="barcode">Barcode:</label>
        <input type="text" id="barcode">

        <label for="berat">Berat:</label>
        <input type="number" id="berat" inputmode="decimal">
      `;
    }

    function renderMassalForm(jumlah) {
      let html = '';
      for (let i = 1; i <= jumlah; i++) {
        html += `
          <label for="barcode${i}">Barcode ${i}:</label>
          <input type="text" id="barcode${i}">

          <label for="berat${i}">Berat ${i}:</label>
          <input type="number" id="berat${i}" inputmode="decimal">
        `;
      }
      formContainer.innerHTML = html;
    }

    async function kirimData() {
      const mode = modeSelect.value;
      const nama = document.getElementById('nama').value;
      const issue = document.getElementById('issue').value;
      const ncm = document.getElementById('ncm').value;
      const tanggal = document.getElementById('tanggal').value;
      let data = [];

      if (mode === 'single') {
        data.push({
          tanggal,
          nama,
          issue,
          ncm,
          barcode: document.getElementById('barcode').value,
          berat: document.getElementById('berat').value
        });
      } else {
        const jumlah = parseInt(jumlahBobbinSelect.value);
        for (let i = 1; i <= jumlah; i++) {
          data.push({
            tanggal,
            nama,
            issue,
            ncm,
            barcode: document.getElementById(`barcode${i}`).value,
            berat: document.getElementById(`berat${i}`).value
          });
        }
      }

      try {
        await fetch("https://script.google.com/macros/s/AKfycbzsGLwFyAjQO3IKP4SUk5HVAPndXFWzbV6OAv4BjmRWfd1LmRD6D7aP-_HBS2Vm5ZDcyA/exec", {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" }
        });
        alert("Data berhasil dikirim!");
      } catch (error) {
        alert("Gagal mengirim data: " + error.message);
      }
    }

    // Default mode saat halaman dimuat
    renderSingleForm();
  </script>
</body>
</html>
