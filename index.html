<!-- HTML (index.html) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>INPUT NCM</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
      color: #212529;
      transition: all 0.3s;
    }
    .dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      max-height: 60px;
    }
    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .status {
      font-size: 0.9em;
    }
    #notif {
      margin-top: 10px;
      font-weight: bold;
    }
    label, legend {
      font-weight: bold;
    }
    fieldset {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      background-color: #ffffff;
    }
    .dark-mode fieldset {
      background-color: #1e1e1e;
      border-color: #444;
    }
    input[type="text"], input[type="number"], input[type="date"] {
      width: 100%;
      margin: 5px 0 10px 0;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      margin-right: 5px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    .submit-btn { background-color: #007bff; color: white; }
    .reset-btn { background-color: #6c757d; color: white; }
  </style>
</head>
<body>
  <div class="header">
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA+gAAAD6CAYAAABLy9DKAAAACXBIWXMAAAsSAAALEgHS3X78AAA... (dipersingkat) ...==" alt="Logo" class="logo">
    <div class="controls">
      <span class="status" id="status-indicator">üü¢ Online</span>
      <label><input type="checkbox" id="theme-toggle"> üåô</label>
    </div>
  </div>

  <h2>INPUT NCM</h2>
  <form id="barcode-form">
    <label>Nama: <input type="text" name="nama" required></label><br>
    <label>Tanggal: <input type="date" name="tanggal" required></label><br>
    <label>Issue: <input type="text" name="issue" required></label><br>
    <label>NCM: <input type="text" name="ncm" required></label><br>

    <label>Jumlah Bobbin:
      <select id="jumlah" name="jumlah">
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
      </select>
    </label><br><br>

    <div id="bobbin-fields"></div>

    <button type="submit" class="submit-btn">Submit</button>
    <button type="button" class="reset-btn" onclick="handleReset()">Reset</button>
    <div id="notif"></div>
  </form>

  <script>
    const form = document.getElementById('barcode-form');
    const bobbinFields = document.getElementById('bobbin-fields');
    const jumlah = document.getElementById('jumlah');
    const statusEl = document.getElementById('status-indicator');
    const toggleTheme = document.getElementById('theme-toggle');
    const notif = document.getElementById('notif');

    function generateBobbinFields(count) {
      bobbinFields.innerHTML = '';
      for (let i = 1; i <= count; i++) {
        bobbinFields.innerHTML += `
          <fieldset>
            <legend>Bobbin ${i}</legend>
            <label>Barcode: <input type="text" name="barcode${i}" required></label><br>
            <label>Berat: <input type="number" name="berat${i}" step="any" required></label>
          </fieldset>
        `;
      }
    }

    function handleReset() {
      form.reset();
      generateBobbinFields(1);
      notif.textContent = '';
    }

    jumlah.addEventListener('change', (e) => {
      generateBobbinFields(Number(e.target.value));
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      notif.style.color = 'orange';
      notif.textContent = '‚è≥ Sedang mengirim data...';

      const data = new FormData(form);
      const requiredFields = ['nama', 'tanggal', 'issue', 'ncm'];
      for (let field of requiredFields) {
        if (!data.get(field)) {
          alert(`Field "${field}" tidak boleh kosong.`);
          notif.textContent = '';
          return;
        }
      }

      const jumlahBobbin = Number(data.get('jumlah'));
      for (let i = 1; i <= jumlahBobbin; i++) {
        const payload = {
          nama: data.get('nama'),
          tanggal: data.get('tanggal'),
          issue: data.get('issue'),
          ncm: data.get('ncm'),
          barcode: data.get(`barcode${i}`),
          berat: data.get(`berat${i}`)
        };
        await fetch("https://script.google.com/macros/s/AKfycbyyOj9kIf1mihKdNKzQC-9O6iYM0cefAKq_8NWskwqQv1bm5wSCp_mlV-mQrKgVGNkg/exec", {
          method: "POST",
          mode: "no-cors",
          body: JSON.stringify(payload)
        });
      }

      notif.style.color = 'green';
      notif.textContent = '‚úÖ Data berhasil dikirim!';
      form.reset();
      generateBobbinFields(1);
    });

    function updateStatus() {
      statusEl.textContent = navigator.onLine ? "üü¢ Online" : "üî¥ Offline";
    }
    window.addEventListener('online', updateStatus);
    window.addEventListener('offline', updateStatus);
    updateStatus();

    toggleTheme.addEventListener('change', () => {
      document.body.classList.toggle('dark-mode');
    });

    generateBobbinFields(1);
  </script>
</body>
</html>
